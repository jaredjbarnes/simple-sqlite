{"version":3,"sources":["../../../src/sqlite/factories/EntityToSqlFactory.js"],"names":["EntityToSqlFactory","entity","tableName","primaryKeys","Array","isArray","length","Error","every","key","columns","map","SqliteUtils","escapeName","escapeStringValue","join","keys","Object","values","escapedKeys","placeHolderArray","fill","sql","validateEntityPrimaryKeys","sqliteData","reduce","accumulator","includes","placeHolderValues","push","whereStatement","createWhereStatement"],"mappings":";;;;;;;;AAAA;;;;;;;;IAEqBA,kB;AACjB,sCAIG;AAAA,YAHCC,MAGD,QAHCA,MAGD;AAAA,YAFCC,SAED,QAFCA,SAED;AAAA,YADCC,WACD,QADCA,WACD;;AAAA;;AACC,YAAI,CAACC,MAAMC,OAAN,CAAcF,WAAd,CAAD,IAA+BA,YAAYG,MAAZ,KAAuB,CAA1D,EAA6D;AACzD,kBAAM,IAAIC,KAAJ,CAAU,0FAAV,CAAN;AACH;;AAED,aAAKL,SAAL,GAAiBA,SAAjB;AACA,aAAKD,MAAL,GAAcA,MAAd;AACA,aAAKE,WAAL,GAAmBA,WAAnB;AACH;;;;kDAEyBF,M,EAAQ;AAC9B,gBAAI,KAAKE,WAAL,CAAiBG,MAAjB,KAA4B,CAAhC,EAAmC;AAC/B,uBAAOL,OAAO,KAAKE,WAAL,CAAiB,CAAjB,CAAP,KAA+B,IAAtC;AACH,aAFD,MAEO,IAAI,KAAKA,WAAL,CAAiBG,MAAjB,GAA0B,CAA9B,EAAiC;AACpC,uBAAO,KAAKH,WAAL,CAAiBK,KAAjB,CAAuB,UAACC,GAAD,EAAS;AACnC,2BAAO,OAAOR,OAAOQ,GAAP,CAAP,KAAuB,WAA9B;AACH,iBAFM,CAAP;AAGH,aAJM,MAIA;AACH,uBAAO,KAAP;AACH;AACJ;;;6CAEoBR,M,EAAQ;AACzB,gBAAMS,UAAU,KAAKP,WAAL,CAAiBQ,GAAjB,CAAqB,UAACF,GAAD,EAAS;AAC1C,uBAAUG,sBAAYC,UAAZ,CAAuBJ,GAAvB,CAAV,WAA2CG,sBAAYE,iBAAZ,CAA8Bb,OAAOQ,GAAP,CAA9B,CAA3C;AACH,aAFe,EAEbM,IAFa,CAER,IAFQ,CAAhB;;AAIA,8BAAgBL,OAAhB;AACH;;;gDAEuB;AACpB,gBAAMT,SAAS,KAAKA,MAApB;AACA,gBAAMe,OAAOC,OAAOD,IAAP,CAAYf,MAAZ,CAAb;AACA,gBAAMiB,SAASF,KAAKL,GAAL,CAAS,UAACF,GAAD,EAAS;AAC7B,uBAAOR,OAAOQ,GAAP,CAAP;AACH,aAFc,CAAf;AAGA,gBAAMU,cAAcH,KAAKL,GAAL,CAAS,UAACF,GAAD,EAAS;AAClC,uBAAOG,sBAAYC,UAAZ,CAAuBJ,GAAvB,CAAP;AACH,aAFmB,CAApB;;AAIA,gBAAMW,mBAAmB,IAAIhB,KAAJ,CAAUY,KAAKV,MAAf,EAAuBe,IAAvB,CAA4B,GAA5B,EAAiCN,IAAjC,CAAsC,IAAtC,CAAzB;;AAEA,mBAAO;AACHO,sCAAoBV,sBAAYC,UAAZ,CAAuB,KAAKX,SAA5B,CAApB,WAAgEiB,YAAYJ,IAAZ,CAAiB,IAAjB,CAAhE,oBAAqGK,gBAArG,OADG;AAEHF,wBAAQA;AAFL,aAAP;AAKH;;;gDAEuB;AAAA;;AACpB,gBAAMjB,SAAS,KAAKA,MAApB;AACA,gBAAMe,OAAOC,OAAOD,IAAP,CAAYf,MAAZ,CAAb;;AAEA,gBAAI,CAAC,KAAKsB,yBAAL,CAA+BtB,MAA/B,CAAL,EAA6C;AACzC,sBAAM,IAAIM,KAAJ,CAAU,+CAAV,CAAN;AACH;;AAED,gBAAMiB,aAAaR,KAAKS,MAAL,CAAY,UAACC,WAAD,EAAcjB,GAAd,EAAsB;AACjD,oBAAI,MAAKN,WAAL,CAAiBwB,QAAjB,CAA0BlB,GAA1B,CAAJ,EAAoC;AAChC,2BAAOiB,WAAP;AACH;;AAEDA,4BAAYE,iBAAZ,CAA8BC,IAA9B,CAAsCjB,sBAAYC,UAAZ,CAAuBJ,GAAvB,CAAtC;AACAiB,4BAAYR,MAAZ,CAAmBW,IAAnB,CAAwB5B,OAAOQ,GAAP,CAAxB;AACA,uBAAOiB,WAAP;AACH,aARkB,EAQhB,EAAEE,mBAAmB,EAArB,EAAyBV,QAAQ,EAAjC,EARgB,CAAnB;;AAUA,gBAAMY,iBAAiB,KAAKC,oBAAL,CAA0B9B,MAA1B,CAAvB;;AAEA,mBAAO;AACHqB,iCAAeV,sBAAYC,UAAZ,CAAuB,KAAKX,SAA5B,CAAf,aAA6DsB,WAAWI,iBAAX,CAA6Bb,IAA7B,CAAkC,IAAlC,CAA7D,SAAwGe,cADrG;AAEHZ,wBAAQM,WAAWN;AAFhB,aAAP;AAIH;;;gDAEuB;AACpB,gBAAMjB,SAAS,KAAKA,MAApB;;AAEA,gBAAI,CAAC,KAAKsB,yBAAL,CAA+BtB,MAA/B,CAAL,EAA6C;AACzC,sBAAM,IAAIM,KAAJ,CAAU,+CAAV,CAAN;AACH;;AAED,gBAAMuB,iBAAiB,KAAKC,oBAAL,CAA0B9B,MAA1B,CAAvB;;AAEA,mBAAO;AACHqB,sCAAoBV,sBAAYC,UAAZ,CAAuB,KAAKX,SAA5B,CAApB,SAA8D4B,cAD3D;AAEHZ,wBAAQ;AAFL,aAAP;AAIH;;;;;;kBA7FgBlB,kB","file":"EntityToSqlFactory.js","sourcesContent":["import SqliteUtils from \"../utils/SqliteUtils\";\n\nexport default class EntityToSqlFactory {\n    constructor({\n        entity,\n        tableName,\n        primaryKeys\n    }) {\n        if (!Array.isArray(primaryKeys) || primaryKeys.length === 0) {\n            throw new Error(\"Invalid Argument Exception:'primaryKeys' needs to be an array of length greater than 0. \");\n        }\n\n        this.tableName = tableName;\n        this.entity = entity;\n        this.primaryKeys = primaryKeys;\n    }\n\n    validateEntityPrimaryKeys(entity) {\n        if (this.primaryKeys.length === 1) {\n            return entity[this.primaryKeys[0]] != null;\n        } else if (this.primaryKeys.length > 1) {\n            return this.primaryKeys.every((key) => {\n                return typeof entity[key] !== \"undefined\";\n            })\n        } else {\n            return false;\n        }\n    }\n\n    createWhereStatement(entity) {\n        const columns = this.primaryKeys.map((key) => {\n            return `${SqliteUtils.escapeName(key)} = ${SqliteUtils.escapeStringValue(entity[key])}`;\n        }).join(\", \");\n\n        return `WHERE ${columns}`;\n    }\n\n    createInsertStatement() {\n        const entity = this.entity;\n        const keys = Object.keys(entity);\n        const values = keys.map((key) => {\n            return entity[key];\n        });\n        const escapedKeys = keys.map((key) => {\n            return SqliteUtils.escapeName(key);\n        });\n\n        const placeHolderArray = new Array(keys.length).fill(\"?\").join(\", \");\n\n        return {\n            sql: `INSERT INTO ${SqliteUtils.escapeName(this.tableName)} ( ${escapedKeys.join(\", \")} ) VALUES ( ${placeHolderArray} )`,\n            values: values\n        }\n\n    }\n\n    createUpdateStatement() {\n        const entity = this.entity;\n        const keys = Object.keys(entity);\n\n        if (!this.validateEntityPrimaryKeys(entity)) {\n            throw new Error(\"Cannot update entity: Invalid primary key(s).\");\n        }\n\n        const sqliteData = keys.reduce((accumulator, key) => {\n            if (this.primaryKeys.includes(key)) {\n                return accumulator;\n            }\n\n            accumulator.placeHolderValues.push(`${SqliteUtils.escapeName(key)} = ?`);\n            accumulator.values.push(entity[key]);\n            return accumulator;\n        }, { placeHolderValues: [], values: [] });\n\n        const whereStatement = this.createWhereStatement(entity);\n\n        return {\n            sql: `UPDATE ${SqliteUtils.escapeName(this.tableName)} SET ${sqliteData.placeHolderValues.join(\", \")} ${whereStatement}`,\n            values: sqliteData.values\n        }\n    }\n\n    createDeleteStatement() {\n        const entity = this.entity;\n\n        if (!this.validateEntityPrimaryKeys(entity)) {\n            throw new Error(\"Cannot delete entity: Invalid primary key(s).\");\n        }\n\n        const whereStatement = this.createWhereStatement(entity);\n\n        return {\n            sql: `DELETE FROM ${SqliteUtils.escapeName(this.tableName)} ${whereStatement}`,\n            values: []\n        }\n    }\n}"]}