{"version":3,"sources":["../../../src/sqlite/statements/UpdateWhereStatementCreator.js"],"names":["UpdateWhereStatementCreator","queryable","updates","Error","SqliteUtils","escapeName","type","visitor","SqlVisitor","createWhereExpression","query","expression","keys","Object","statement","reduce","accumulator","key","placeHolderValues","push","values","sql","getTableName","join","updateStatement","createSetExpression","whereStatement","updateWhereStatementCreator","createStatement"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AACA;;;;;;IAEqBA,2B;AACjB,yCAAYC,SAAZ,EAAuBC,OAAvB,EAAgC;AAAA;;AAE5B,YAAID,aAAa,IAAjB,EAAuB;AACnB,kBAAM,IAAIE,KAAJ,CAAU,qEAAV,CAAN;AACH;;AAED,YAAID,WAAW,IAAf,EAAoB;AAChB,kBAAM,IAAIC,KAAJ,CAAU,kDAAV,CAAN;AACH;;AAED,aAAKD,OAAL,GAAeA,OAAf;AACA,aAAKD,SAAL,GAAiBA,SAAjB;AACH;;;;uCAOa;AACV,mBAAOG,sBAAYC,UAAZ,CAAuB,KAAKJ,SAAL,CAAeK,IAAtC,CAAP;AACH;;;gDAEuB;AACpB,gBAAMC,UAAU,IAAIC,oBAAJ,EAAhB;AACA,mBAAOD,QAAQE,qBAAR,CAA8B,KAAKR,SAAL,CAAeS,KAAf,CAAqBC,UAAnD,CAAP;AACH;;;8CAEqB;AAClB,gBAAMT,UAAU,KAAKA,OAArB;AACA,gBAAMU,OAAOC,OAAOD,IAAP,CAAYV,OAAZ,CAAb;;AAEA,gBAAMY,YAAYF,KAAKG,MAAL,CAAY,UAACC,WAAD,EAAcC,GAAd,EAAsB;AAChD,oBAAIA,QAAQ,IAAZ,EAAkB;AACd,2BAAOD,WAAP;AACH;;AAEDA,4BAAYE,iBAAZ,CAA8BC,IAA9B,CAAsCf,sBAAYC,UAAZ,CAAuBY,GAAvB,CAAtC;AACAD,4BAAYI,MAAZ,CAAmBD,IAAnB,CAAwBjB,QAAQe,GAAR,CAAxB;AACA,uBAAOD,WAAP;AACH,aARiB,EAQf,EAAEE,mBAAmB,EAArB,EAAyBE,QAAQ,EAAjC,EARe,CAAlB;;AAUA,mBAAO;AACHC,iCAAe,KAAKC,YAAL,EAAf,aAA0CR,UAAUI,iBAAV,CAA4BK,IAA5B,CAAiC,IAAjC,CADvC;AAEHH,wBAAQN,UAAUM;AAFf,aAAP;AAKH;;;0CAEiB;AACd,gBAAMlB,UAAU,KAAKA,OAArB;AACA,gBAAMsB,kBAAkB,KAAKC,mBAAL,CAAyBvB,OAAzB,CAAxB;AACA,gBAAMwB,iBAAiB,KAAKjB,qBAAL,EAAvB;;AAEA,gBAAIY,MAAMG,gBAAgBH,GAA1B;;AAEA,gBAAIK,kBAAkB,EAAtB,EAA0B;AACtBL,sBAASA,GAAT,SAAgBK,cAAhB;AACH;;AAED,mBAAO;AACHL,wBADG;AAEHD,wBAAQI,gBAAgBJ;AAFrB,aAAP;AAIH;;;wCAlDsBnB,S,EAAWC,O,EAAQ;AACtC,gBAAMyB,8BAA8B,IAAI3B,2BAAJ,CAAgCC,SAAhC,EAA2CC,OAA3C,CAApC;AACA,mBAAOyB,4BAA4BC,eAA5B,EAAP;AACH;;;;;;kBAlBgB5B,2B","file":"UpdateWhereStatementCreator.js","sourcesContent":["import SqlVisitor from \"../visitors/SqlVisitor\";\nimport SqliteUtils from \"../utils/SqliteUtils\";\nimport { timingSafeEqual } from \"crypto\";\n\nexport default class UpdateWhereStatementCreator {\n    constructor(queryable, updates) {\n\n        if (queryable == null) {\n            throw new Error(\"Null Argument Exception: A queryable is needed to create statement.\");\n        }\n\n        if (updates == null){\n            throw new Error(\"Null Argument Exception: updates cannot be null.\");\n        }\n\n        this.updates = updates;\n        this.queryable = queryable;\n    }\n\n    static createStatement(queryable, updates){\n        const updateWhereStatementCreator = new UpdateWhereStatementCreator(queryable, updates);\n        return updateWhereStatementCreator.createStatement();\n    }\n\n    getTableName(){\n        return SqliteUtils.escapeName(this.queryable.type);\n    }\n\n    createWhereExpression() {\n        const visitor = new SqlVisitor();\n        return visitor.createWhereExpression(this.queryable.query.expression);\n    }\n\n    createSetExpression() {\n        const updates = this.updates;\n        const keys = Object.keys(updates);\n\n        const statement = keys.reduce((accumulator, key) => {\n            if (key === \"id\") {\n                return accumulator;\n            }\n\n            accumulator.placeHolderValues.push(`${SqliteUtils.escapeName(key)} = ?`);\n            accumulator.values.push(updates[key]);\n            return accumulator;\n        }, { placeHolderValues: [], values: [] });\n\n        return {\n            sql: `UPDATE ${this.getTableName()} SET ${statement.placeHolderValues.join(\", \")}`,\n            values: statement.values\n        }\n\n    }\n\n    createStatement() {\n        const updates = this.updates;\n        const updateStatement = this.createSetExpression(updates);\n        const whereStatement = this.createWhereExpression();\n\n        let sql = updateStatement.sql;\n\n        if (whereStatement != \"\") {\n            sql = `${sql} ${whereStatement}`;\n        }\n\n        return {\n            sql,\n            values: updateStatement.values\n        }\n    }\n}"]}