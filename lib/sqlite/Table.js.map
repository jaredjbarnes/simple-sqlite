{"version":3,"sources":["../../src/sqlite/Table.js"],"names":["Table","constructor","database","schema","lifeCycleDelegate","name","sqliteDatabaseWrapper","Sqlite3Wrapper","primaryKeys","addAsync","entity","alteredEntity","sql","values","InsertStatementCreator","createStatement","tableName","result","runAsync","removeAsync","DeleteStatementCreator","updateAsync","UpdateStatementCreator","getQueryProvider","Provider","where","provider","Queryable","query","type","expression","select","limit","offset","orderBy"],"mappings":"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","sourcesContent":["import Provider from \"./Provider\";\nimport Queryable from \"../queryable/Queryable\";\nimport Sqlite3Wrapper from \"./Sqlite3Wrapper\";\nimport InsertStatementCreator from \"./statements/InsertStatementCreator\";\nimport UpdateStatementCreator from \"./statements/UpdateStatementCreator\";\nimport DeleteStatementCreator from \"./statements/DeleteStatementCreator\";\nimport invokeMethodAsync from \"./utils/invokeMethodAsync\";\n\nexport default class Table {\n    constructor({ database, schema, lifeCycleDelegate }) {\n\n        if (lifeCycleDelegate == null || typeof lifeCycleDelegate !== \"object\") {\n            lifeCycleDelegate = {};\n        }\n\n        this.name = schema.name;\n        this.database = database;\n        this.sqliteDatabaseWrapper = new Sqlite3Wrapper(this.database);\n        this.primaryKeys = schema.primaryKeys;\n        this.lifeCycleDelegate = lifeCycleDelegate;\n    }\n\n    async addAsync(entity) {\n\n        await invokeMethodAsync(\n            this.lifeCycleDelegate,\n            \"canEntityBeAddedAsync\",\n            [entity, this.schema]\n        );\n\n        const alteredEntity = await invokeMethodAsync(\n            this.lifeCycleDelegate,\n            \"prepareEntityToBeAddedAsync\",\n            [entity, this.schema],\n            entity\n        );\n\n        const { sql, values } = InsertStatementCreator.createStatement({\n            tableName: this.name,\n            entity: alteredEntity,\n            primaryKeys: this.primaryKeys\n        });\n\n        const result = await this.sqliteDatabaseWrapper.runAsync(sql, values);\n\n        return await invokeMethodAsync(\n            this.lifeCycleDelegate,\n            \"entityAddedAsync\",\n            [alteredEntity, result, this.schema],\n            result\n        );\n\n    }\n\n    async removeAsync(entity) {\n\n        await invokeMethodAsync(\n            this.lifeCycleDelegate,\n            \"canEntityBeRemovedAsync\",\n            [entity, this.schema]\n        );\n\n        const alteredEntity = await invokeMethodAsync(\n            this.lifeCycleDelegate,\n            \"prepareEntityToBeRemovedAsync\",\n            [entity, this.schema],\n            entity\n        );\n\n        const { sql, values } = DeleteStatementCreator.createStatement({\n            tableName: this.name,\n            entity: alteredEntity,\n            primaryKeys: this.primaryKeys\n        });\n\n        const result = await this.sqliteDatabaseWrapper.runAsync(sql, values);\n\n        return invokeMethodAsync(\n            this.lifeCycleDelegate,\n            \"entityRemovedAsync\",\n            [alteredEntity, result, this.schema],\n            result\n        );\n\n    }\n\n    async updateAsync(entity) {\n        await invokeMethodAsync(\n            this.lifeCycleDelegate,\n            \"canEntityBeUpdatedAsync\",\n            [entity, this.schema]\n        );\n\n        const alteredEntity = await invokeMethodAsync(\n            this.lifeCycleDelegate,\n            \"prepareEntityToBeUpdatedAsync\",\n            [entity, this.schema],\n            entity\n        );\n\n        const { sql, values } = UpdateStatementCreator.createStatement({\n            tableName: this.name,\n            entity: alteredEntity,\n            primaryKeys: this.primaryKeys\n        });\n\n        const result = await this.sqliteDatabaseWrapper.runAsync(sql, values);\n\n        return await invokeMethodAsync(\n            this.lifeCycleDelegate,\n            \"entityUpdatedAsync\",\n            [alteredEntity, result, this.schema],\n            result\n        );\n\n    }\n\n    getQueryProvider() {\n        return new Provider({\n            database: this.database,\n            lifeCycleDelegate: this.lifeCycleDelegate\n        });\n    }\n\n    where() {\n        const provider = this.getQueryProvider();\n\n        return new Queryable({\n            query: {\n                type: this.name,\n                expression: null,\n                select: {},\n                limit: -1,\n                offset: 0,\n                orderBy: []\n            },\n            provider: provider\n        });\n    }\n\n}"],"file":"Table.js"}